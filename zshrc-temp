# Load Nix if not ready
if [[ ! $(command -v nix) && -e '/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh' ]]; then
  source '/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh'
fi

typeset -U path cdpath fpath manpath
for profile in ${(z)NIX_PROFILES}; do
  fpath+=($profile/share/zsh/site-functions $profile/share/zsh/$ZSH_VERSION/functions $profile/share/zsh/vendor-completions)
done

HELPDIR="/nix/store/i8c3lvyjcciljizv5bbign9rgfkzk0fh-zsh-5.9/share/zsh/$ZSH_VERSION/help"

# Add plugin directories to PATH and fpath
plugin_dirs=(
  powerlevel10k
)
for plugin_dir in "${plugin_dirs[@]}"; do
  path+="/Users/gyutak/.zsh/plugins/$plugin_dir"
  fpath+="/Users/gyutak/.zsh/plugins/$plugin_dir"
done
unset plugin_dir plugin_dirs


source /nix/store/nk22gl93k4j04b7h3as62bnga9sddxsj-zsh-autosuggestions-0.7.1/share/zsh-autosuggestions/zsh-autosuggestions.zsh
ZSH_AUTOSUGGEST_STRATEGY=(history)


# oh-my-zsh extra settings for plugins

# oh-my-zsh configuration generated by NixOS
plugins=(direnv fzf git docker aws kubectl z)


source $ZSH/oh-my-zsh.sh

# Source plugins
plugins=(
  powerlevel10k/powerlevel10k.zsh-theme
)
for plugin in "${plugins[@]}"; do
  [[ -f "/Users/gyutak/.zsh/plugins/$plugin" ]] && source "/Users/gyutak/.zsh/plugins/$plugin"
done
unset plugin plugins

# History options should be set in .zshrc and after oh-my-zsh sourcing.
# See https://github.com/nix-community/home-manager/issues/177.
HISTSIZE="10000"
SAVEHIST="10000"

HISTFILE="/Users/gyutak/.zsh_history"
mkdir -p "$(dirname "$HISTFILE")"

setopt HIST_FCNTL_LOCK

# Enabled history options
enabled_opts=(
  EXTENDED_HISTORY HIST_IGNORE_DUPS HIST_IGNORE_SPACE SHARE_HISTORY
)
for opt in "${enabled_opts[@]}"; do
  setopt "$opt"
done
unset opt enabled_opts

# Disabled history options
disabled_opts=(
  APPEND_HISTORY HIST_EXPIRE_DUPS_FIRST HIST_FIND_NO_DUPS HIST_IGNORE_ALL_DUPS
  HIST_SAVE_NO_DUPS
)
for opt in "${disabled_opts[@]}"; do
  unsetopt "$opt"
done
unset opt disabled_opts

if [[ $options[zle] = on ]]; then
  source <(/nix/store/b13kq65h8bk32jqqyvjlafk9kc8ads4n-fzf-0.65.2/bin/fzf --zsh)
fi

# Initialize p10k configuration
[[ -f ~/.p10k.zsh ]] && source ~/.p10k.zsh

# Initialize mise
if command -v mise > /dev/null; then
  eval "$(mise activate zsh)"
fi

# Enable colors
autoload -U colors && colors

# Ensure oh-my-zsh cache directory has proper permissions
if [ -d "$HOME/.cache/oh-my-zsh" ]; then
  chmod -R 755 "$HOME/.cache/oh-my-zsh" 2>/dev/null || true
else
  mkdir -p "$HOME/.cache/oh-my-zsh"
  chmod -R 755 "$HOME/.cache/oh-my-zsh" 2>/dev/null || true
fi

# Set zsh completion to use LS_COLORS
zstyle ':completion:*' list-colors "$LS_COLORS"

# Set uv shell completion
if command -v uv > /dev/null; then
  eval "$(uv generate-shell-completion zsh)"
fi

eval "$(/nix/store/gbv43vz3npy7khzf9pf3wi56h2g3v4zc-direnv-2.37.1/bin/direnv hook zsh)"

alias -- ccusage='npx ccusage@latest'
alias -- hm=home-manager
alias -- hmb='home-manager build'
alias -- hms='home-manager switch'
alias -- java17='java-switch 17'
alias -- java8='java-switch 8'
alias -- kl=kubectl
alias -- kn=kubens
alias -- kx=kubectx
alias -- lh='ls -lh --color=auto'
alias -- ll='ls -la --color=auto'
alias -- ls='ls --color=auto'
alias -- sbt17=/nix/store/ykfp1ghsc5xm6kx3ia3488zakv8j7ar4-sbt-1.11.6/bin/sbt
alias -- sbt8=/nix/store/snrxg2309ncxr59srhv7x3crqdanjhw3-sbt-1.11.6/bin/sbt
alias -- tf='AWS_PROFILE=saml terraform'
alias -- ur='uv run'
alias -- vi=nvim
alias -- vim=nvim
alias -- vimdiff='nvim -d'
source /nix/store/5sz7nq1fa9xm5qmr4bykqcf9cz9b9gkf-zsh-syntax-highlighting-0.8.0/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
ZSH_HIGHLIGHT_HIGHLIGHTERS+=()


