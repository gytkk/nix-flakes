# Nix Flake 구조 개선 사항 TODO

## 🔧 코드 중복 제거 및 추상화

### TODO 1: Package 정의 함수화

- [v] `flake.nix`의 `pkgs` 정의에서 중복 제거
- [v] 공통 package 설정을 `mkPkgs` 함수로 추출
- [v] 시스템별 overlay 설정 통합

### TODO 2: Home Configuration 헬퍼 함수 생성

- [v] `mkHomeConfig` 함수 생성으로 반복 코드 제거
- [v] 환경별 설정을 매개변수화
- [v] `extraSpecialArgs` 패턴 표준화

### TODO 3: 라이브러리 디렉토리 구조 생성

- [v] `lib/` 디렉토리 생성
- [v] `lib/default.nix` - 라이브러리 익스포트
- [v] `lib/builders.nix` - 빌더 헬퍼 함수들

## 🎯 환경 설정 개선

### TODO 4: 환경별 설정 중앙화

- [v] 환경별 설정을 별도 파일로 분리
  - `environments/devsisters-macbook.nix`
  - `environments/devsisters-macstudio.nix`  
  - `environments/wsl-ubuntu.nix`
- [v] 하드코딩된 값들을 환경 설정으로 이동
  - 사용자명, 홈 디렉토리
  - Git 사용자 정보
  - 시스템별 경로

### TODO 5: 모듈 구조 표준화

- [ ] 모듈별 매개변수 일관성 확보
- [ ] `git` 모듈에서 하드코딩된 사용자 정보 제거
- [ ] `zsh` 모듈에서 환경별 alias 분리
- [ ] `devsisters` 모듈에서 패키지와 설정 분리

### TODO 6: 프로필 시스템 구현

- [ ] `modules/profiles/` 디렉토리 생성
  - `base.nix` - 기본 패키지
  - `development.nix` - 개발 도구
  - `work.nix` - 업무용 도구
- [ ] 환경별 프로필 조합 시스템 구현

## 🏗️ 아키텍처 개선

### TODO 7: Darwin Configuration 정리

- [ ] 사용하지 않는 darwin configuration 제거 또는 구현
- [ ] WSL 환경에서 잘못된 `nix-darwin` 사용 수정
- [ ] macOS 전용 설정과 일반 설정 분리

### TODO 8: 조건부 모듈 로딩 시스템

- [ ] 환경 타입별 모듈 자동 로딩
- [ ] 플랫폼별 조건부 패키지 설치
- [ ] 선택적 기능 활성화 시스템

### TODO 9: 설정 검증 시스템

- [ ] 환경 설정 스키마 정의
- [ ] 필수 매개변수 검증
- [ ] 설정 충돌 감지

## 📦 패키지 및 도구 관리

### TODO 10: 패키지 카테고리화

- [ ] 시스템 유틸리티 분리
- [ ] 개발 도구 그룹화
- [ ] 환경별 전용 패키지 식별

### TODO 11: 도구 버전 관리 개선

- [ ] Terraform 버전을 환경별로 설정 가능하게 변경
- [ ] 도구 버전 중앙 관리 시스템
- [ ] 프로젝트별 도구 설정 지원

## 🔄 사용성 개선

### TODO 12: 새로운 환경 추가 자동화

- [ ] 환경 템플릿 생성
- [ ] 환경 생성 스크립트 작성
- [ ] 환경 설정 검증 도구

### TODO 13: 설정 업데이트 편의성

- [ ] 환경별 설정 오버라이드 시스템
- [ ] 설정 변경 시 영향 범위 명시
- [ ] 점진적 설정 적용 지원

### TODO 14: 문서화 개선

- [ ] 새로운 구조에 맞는 CLAUDE.md 업데이트
- [ ] 환경 추가 가이드 작성
- [ ] 모듈 사용법 문서화

## 🚀 마이그레이션 계획

### Phase 1: 기초 구조 개선

1. `lib/` 디렉토리 및 헬퍼 함수 생성
2. 환경 설정 중앙화
3. 기본적인 코드 중복 제거

### Phase 2: 모듈 시스템 개선

1. 모듈 구조 표준화
2. 프로필 시스템 구현
3. 조건부 로딩 시스템

### Phase 3: 고급 기능 추가

1. 설정 검증 시스템
2. 자동화 도구
3. 문서화 완성

## 📋 예상 효과

이러한 개선을 통해 다음과 같은 효과를 기대할 수 있습니다:

✅ **새로운 환경 추가 시간 단축**: 템플릿 기반으로 5분 내 새 환경 생성  
✅ **설정 관리 복잡도 감소**: 중앙화된 설정으로 일관성 확보  
✅ **코드 재사용성 향상**: 모듈화를 통한 공통 설정 재사용  
✅ **유지보수성 개선**: 구조화된 설정으로 변경 영향 범위 최소화  
✅ **오류 감소**: 검증 시스템으로 설정 오류 사전 방지  

## 우선순위

1. **High Priority**: TODO 1, 2, 4, 5 (기본 구조 개선)
2. **Medium Priority**: TODO 6, 7, 8 (아키텍처 개선)  
3. **Low Priority**: TODO 9, 12, 13, 14 (편의성 및 자동화)
